
[All]
sudo apt install vim
sudo vim /etc/systemd/system/network_tc_setup.service

!
[Unit]
Description=Network Traffic Control Setup

[Service]
Type=oneshot
ExecStart=/etc/network_tc_setup.sh

[Install]
WantedBy=multi-user.target
!


sudo vim /etc/network_tc_setup.sh

[lowpaxos-01]

#!/bin/bash
tc qdisc add dev enp65s0f0 root handle 1: tbf rate 256kbit buffer 1600 limit 3000
tc qdisc add dev enp65s0f0 parent 1:1 handle 10: netem delay 20ms loss 0.5%
!



[lowpaxos-02]

#!/bin/bash
tc qdisc add dev enp65s0f0 root handle 1: tbf rate 200kbit buffer 1600 limit 3000
tc qdisc add dev enp65s0f0 parent 1:1 handle 10: netem delay 30ms loss 0.55%
!

[lowpaxos-03]

#!/bin/bash
tc qdisc add dev enp65s0f0 root handle 1: tbf rate 175kbit buffer 1600 limit 3000
tc qdisc add dev enp65s0f0 parent 1:1 handle 10: netem delay 25ms loss 0.55%
!


[lowpaxos-04]

#!/bin/bash
tc qdisc add dev enp65s0f0 root handle 1: tbf rate 150kbit buffer 1600 limit 3000
tc qdisc add dev enp65s0f0 parent 1:1 handle 10: netem delay 40ms loss 0.6%
!


[lowpaxos-05]

#!/bin/bash
tc qdisc add dev enp65s0f0 root handle 1: tbf rate 120kbit buffer 1600 limit 3000
tc qdisc add dev enp65s0f0 parent 1:1 handle 10: netem delay 100ms loss 1%
!

#Enable and state the traffic shaping service

sudo chmod +x /etc/network_tc_setup.sh
sudo systemctl enable network_tc_setup.service
sudo systemctl start network_tc_setup.service

 


############################################################################################################

#01
sudo tc qdisc add dev enp1s0d1 root handle 1: tbf rate 256kbit buffer 1600 limit 3000
sudo tc qdisc add dev enp1s0d1 parent 1:1 handle 10: netem delay 20ms loss 0.5%

#02
sudo tc qdisc add dev enp1s0d1 root handle 1: tbf rate 200kbit buffer 1600 limit 3000
sudo tc qdisc add dev enp1s0d1 parent 1:1 handle 10: netem delay 30ms loss 0.55%

#03
sudo tc qdisc add dev enp1s0d1 root handle 1: tbf rate 175kbit buffer 1600 limit 3000
sudo tc qdisc add dev enp1s0d1 parent 1:1 handle 10: netem delay 25ms loss 0.55%

#04
sudo tc qdisc add dev enp1s0d1 root handle 1: tbf rate 150kbit buffer 1600 limit 3000
sudo tc qdisc add dev enp1s0d1 parent 1:1 handle 10: netem delay 40ms loss 0.6%

#05
sudo tc qdisc add dev enp1s0d1 root handle 1: tbf rate 120kbit buffer 1600 limit 3000
sudo tc qdisc add dev enp1s0d1 parent 1:1 handle 10: netem delay 100ms loss 1%

############################################################################################################



Client [/proj/rip-PG0/lp-eval/client]

sudo ln -s /proj/rip-PG0/lowpaxos/target/debug/noler /usr/local/bin/noler
sudo ln -s /proj/rip-PG0/lowpaxos/target/debug/noler-client /usr/local/bin/noler-client
sudo ln -s /proj/rip-PG0/lowpaxos/target/debug/noler-bench /usr/local/bin/noler-bench

cargo run --bin noler-client -- -c config.txt -k 50 -w 100 -r 1 -f log.out -n 100 -t 1
cargo run --bin noler-bench -- -c config.txt -k 50 -w 100 -r 1 -f log.out -n 100 -t 1

noler-bench -c config.txt -k 50 -w 100 -r 1 -f log.out -n 50 -t 1
noler-client -c config.txt -k 50 -w 100 -r 1 -f log.out -n 50 -t 1


cd go/src/epaxos-single/
vim runClient.sh 
. runClient.sh > run.txt 


Server [/proj/rip-PG0/lp-eval/server]

sudo ln -s /proj/rip-PG0/lowpaxos/target/debug/noler /usr/local/bin/noler
sudo ln -s /proj/rip-PG0/lowpaxos/target/debug/noler-client /usr/local/bin/noler-client
sudo ln -s /proj/rip-PG0/lowpaxos/target/debug/noler-bench /usr/local/bin/noler-bench

noler --config config.txt --id  [1..5]

-- MPaxos/EPaxos --
Master
vim runMasterServer.sh
. runMasterServer.sh

Server
vim runServer.sh
. runServer.sh



[Config]
f 2
replica 10.10.1.1:32001
replica 10.10.1.2:32002
replica 10.10.1.3:32003
replica 10.10.1.4:32004
replica 10.10.1.5:32005






######################################
find ../playbooks/ -type f -name "*.yaml" -exec sed -i 's/eno1d1/enp65s0f0/g' {} +
+++++++++++++++++++++++++++++++++++++


Client
/proj/rip-PG0/lowpaxos/playbooks$ ansible-playbook -i inventory.yaml noler.yaml

/proj/rip-PG0/lowpaxos/playbooks$ sh run_playbooks_noler.sh 

/proj/rip-PG0/lowpaxos/evaluation$ noler-bench -c config-cloudlab.txt -k 50 -w 100 -r 1 -f log.out -n 100000 -t 1 > run.txt




scp amwotil@amd161.utah.cloudlab.us:/proj/rip-PG0/lowpaxos/evaluation/run.txt lp-run-15k.txt
scp amwotil@amd161.utah.cloudlab.us:/proj/rip-PG0/lowpaxos/evaluation/log.out_0 lp-log-15k.txt

python3 lp-mp-ep.py lp-log-15k.txt lp-run-15k.txt mp-log-15k.txt mp-run-15k.txt ep-log-15k.txt ep-run-15k.txt


Replicas

cd /proj/rip-PG0/lowpaxos/evaluation
noler --config config-cloudlab.txt --id [1] --profiles profiles/profiles-00 --monitor 10.10.1.6:3000
